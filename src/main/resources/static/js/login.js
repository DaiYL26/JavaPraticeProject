$(document).ready(function(){var t=60;function e(t){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(t)}function a(t,a,i){return e(t)?a.length<6||a.length>18?(alert("密码长度应在 6 ~ 18 "),!1):a===i||(alert("两次密码不一致"),!1):(alert("邮箱格格式不正确"),!1)}$("#forgetGetBtn").click(function(){let a=$("#forgetMail").val();e(a)?t<60?alert("请"+t+"秒后，再试一次"):$.post("api/verify",{mail:a},function(e){if(!0===e.data){$("#forgetGetBtn").attr("disabled",!0);let e=setInterval(function(){0==t?(t=60,$("#forgetTimer").text(""),$("#forgetGetBtn").attr("disabled",!1),clearInterval(e)):($("#forgetTimer").text(t),t--)},1e3)}else alert("请稍后再试~")}):alert("邮箱格式不正确")}),$("#forgetConfirm").click(function(){let t=$("#forgetMail").val(),e=$("#forgetPwd").val(),i=$("#forgetPwd2").val(),n=$("#forgetCode").val();a(t,e,i)&&$.post("api/reset",{mail:t,newPassword:e,verifyCode:n},function(t){1==t.data?(alert("重置成功"),$("#myModal").modal("hide")):alert("重置失败，请检查验证码或邮箱")})}),$("#loginBtn").click(function(){let t=$("#account").val(),e=$("#userPwd").val();$.post("api/login",{account:t,password:e},function(t){null!==t.data?(console.log(JSON.stringify(t.data)),localStorage.setItem("user",JSON.stringify(t.data)),$(location).attr("href","/main")):alert(t.msg)})}),$("#getCodeBtn").click(function(){let a=$("#registerMail").val();e(a)?t<60?alert("请"+t+"秒后，再试一次"):$.post("api/verify",{mail:a},function(e){if(!0===e.data){$("#getCodeBtn").attr("disabled",!0);let e=setInterval(function(){0==t?(t=60,$("#registerTimer").text(""),$("#getCodeBtn").attr("disabled",!1),clearInterval(e)):($("#registerTimer").text(t),t--)},1e3)}else alert("请稍后再试~")}):alert("邮箱格式不正确")}),$("#registerConfirm").click(function(){let t=$("#registerMail").val(),e=$("#registerPhone").val(),i=$("#registerPwd").val(),n=$("#registerPwd2").val(),l=$("#registerNickName").val(),r=$("#verifyCode").val();a(t,i,n)&&(/^1[3456789]\d{9}$/.test(e)?""==l||l.length<2&&l.length>12?alert("昵称不能为空且应为 2 ~ 12 位"):$.post("api/register",{mail:t,phone:e,phone:e,password:i,nickName:l,verifyCode:r},function(t){!0===t.data?(alert("注册成功"),$("#myModal2").modal("hide")):alert(t.msg)}):alert("手机号码格式不正确"))}),$("#CodeLoginBtn").hide(),$("#enterCode").hide(),$("#switcher").click(function(){"验证码登陆"==$("#switcher").text()?($("#CodeLoginBtn").show(),$("#enterCode").show(),$("#enterPwd").hide(),$("#loginBtn").hide(),$("#switcher").text("密码登陆"),$("#account").attr("placeholder","输入您的邮箱")):($("#CodeLoginBtn").hide(),$("#enterCode").hide(),$("#enterPwd").show(),$("#loginBtn").show(),$("#switcher").text("验证码登陆"),$("#account").attr("placeholder","输入您的邮箱/手机"))}),$("#loginGetBtn").click(function(){let a=$("#account").val();e(a)?t<60?alert("请"+t+"秒后，再试一次"):$.post("api/verify",{mail:a},function(e){if(!0===e.data){$("#loginGetBtn").attr("disabled",!0);let e=setInterval(function(){0==t?(t=60,$("#loginTimer").text(""),$("#loginGetBtn").attr("disabled",!1),$("#loginGetBtn").text("获取验证码"),clearInterval(e)):($("#loginGetBtn").text("请等待"+t+"秒"),t--)},1e3)}else alert("请稍后再试~")}):alert("邮箱格式不正确")}),$("#CodeLoginBtn").click(function(){let t=$("#account").val(),a=$("#loginCode").val();e(t)?6==a.length?$.post("api/codeLogin",{mail:t,code:a},function(t){null!==t.data?(console.log(JSON.stringify(t.data)),localStorage.setItem("user",JSON.stringify(t.data)),$(location).attr("href","/main")):alert(t.msg)}):alert("验证码为 6 位"):alert("邮箱格式错误")}),$.get("api/isLogin",function(t){!0===t.data&&$(location).attr("href","/main")})});